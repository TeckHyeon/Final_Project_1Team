<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bitc.mapper.MusicMapper">

<!-- 회원 정보 조회 -->
<select id="selectMemberInfo" parameterType="int" resultType="com.bitc.dto.UsersDto">
	<![CDATA[ 
		select 
			user_pk, user_email, user_pw, user_name, user_phone
		from 
			users
		where 
			user_pk = #{userPk}
	]]>
</select>

<!-- 회원 가입 -->
<insert id="register" parameterType="com.bitc.dto.UsersDto">
	<![CDATA[
		insert into 
			users(user_email, user_pw, user_name, user_phone)
		values
			(#{userEmail}, #{userPw}, #{userName}, #{userPhone}) 
	]]>
</insert>

<!-- 이메일 중복 체크 -->
<select id="emailCheck" parameterType="String" resultType="int">
	<![CDATA[ 
		select 
			count(*)
		from 
			users
		where 
			user_email = #{userEmail}		
	]]>
</select>	


<!-- 회원 정보 수정 -->
<update id="update" parameterType="com.bitc.dto.UsersDto">
	<![CDATA[ 
		update 
			users 
		set 
			user_pw = #{userPw}, user_name = #{userName}, user_phone = #{userPhone}
		where 
			user_pk = #{userPk}
	]]>
</update>

<!-- 회원 탈퇴 -->
<delete id="delete" parameterType="int">
	<![CDATA[
		delete from 
			users 
		where 
			user_pk = #{userPk}
	]]>
</delete>

<!-- Email 찾기 count -->
<select id="findId" parameterType="com.bitc.dto.UsersDto" resultType="int">
	<![CDATA[ 
		select 
			count(*)
		from
			users
		where
			user_phone = #{userPhone}
		and
			user_name = #{userName}
	]]>
</select>

<!-- Email 찾기 tmepId-->
<select id="findGetId" parameterType="com.bitc.dto.UsersDto" resultType="String">
	<![CDATA[ 
		select 
			user_email
		from
			users
		where
			user_phone = #{userPhone}
		and
			user_name = #{userName}
	]]>
</select>

<!-- PW 찾기 count-->
<select id="findPw" parameterType="com.bitc.dto.UsersDto" resultType="int">
	<![CDATA[ 
		select 
			count(*)
		from
			users
		where
			user_phone = #{userEmail}
		and
			user_name = #{userPhone}
	]]>
</select>

<!-- PW 찾기 tempPw-->
<update id="updateTempPw" parameterType="com.bitc.dto.UsersDto">
	<![CDATA[ 
		update 
			users 
		set 
			user_pw = #{userPw}
		where 
			user_email = #{userEmail}
		and
			user_phone = #{userPhone}
	]]>
</update>


<!-- 마이 페이지 -->
<!-- 댓글 -->
<select id="reply" parameterType="int" resultType="com.bitc.dto.MusicReplyDto">
	<![CDATA[ 
		select 
			music_reply_pk, reply 
		from 
			music_reply
		where 
			user_Pk = #{userPk}
		and 
			deleted_yn = "N"
	]]>
</select>
		
<!-- 작성한 게시물 -->
<select id="music" parameterType="int" resultType="com.bitc.dto.MusicDto">
	<![CDATA[ 
		select 
			music_pk, music_title, privacy 
		from 
			music
		where 
			user_pk = #{userPk};
	]]>
</select>

<!-- 음원 관리 -->
<select id="file" parameterType="String" resultType="String">
	<![CDATA[ 
		select 
			original_file_name 
		from 
			music_file
		where 
			uploader_id = #{userEmail};
	]]>
</select>

<!-- 음원 파일 삭제-->
<select id="fileDelete" parameterType="String">
	<![CDATA[ 
		delete from 
			music_file 
		where 
			original_file_name = #{fileName};
	]]>
</select>


</mapper>
